<?php
namespace Wovax\IDX\Admin\Pages;

if (!defined('ABSPATH')) exit;

use Wovax\IDX\Settings\FeedDisplay;
use Wovax\IDX\Utilities\ListingLoader;
use Wovax\IDX\Settings\ListingCardSettings;


class ListingCardAdmin {
	public function __construct() {
       
    }

	public function renderPage() {
		$opts        = new ListingCardSettings();
		$current_status_class = $opts->statusClass();
		$status_class_list = array(
			'rounded-right' => 'Rounded Right',
			'rounded-left' => 'Rounded Left',
			'banner-right' => 'Banner Right',
			'banner-left' => 'Banner Left',
			'slash-right' => 'Slash Right',
			'slash-left' => 'Slash Left'
		);
		ob_start();
		foreach($status_class_list as $class => $name) {
			if($class == $current_status_class) {
				$selected = ' selected';
			} else {
				$selected = '';
			}

			?>
			<option value="<?php echo $class; ?>" <?php echo $selected; ?>><?php echo $name; ?></option>
			<?php
		}
		$status_dropdown_options = ob_get_clean();

		$mls_logo = "https://cache.wovax.com/images/mls-board-logo.jpg";
		$label_value = '<svg width="32px" height="29px" viewBox="0 0 32 29" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          	<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              	<g id="Search-Results---Grid-View" transform="translate(-470.000000, -637.000000)" fill="#FF5C5C" fill-rule="nonzero">
                  	<g id="Listings" transform="translate(199.000000, 419.000000)">
                     	<g id="Listing" transform="translate(0.665296, 0.000000)">
                          	<g id="Favorite" transform="translate(270.334704, 218.000000)">
                              <path d="M16.2560915,26.695487 C16.2333822,26.7194748 16.1879636,26.7514585 16.1728241,26.7754463 C16.1728241,26.7754463 16.3393588,26.6595054 16.2560915,26.7074809 C16.206888,26.7354667 16.1387602,26.7714483 16.0933417,26.80743 C16.2295973,26.695487 16.2598763,26.7434626 16.1728241,26.7714483 C16.1387602,26.7794443 16.1084812,26.7954361 16.0744173,26.803432 C16.0479232,26.811428 16.021429,26.8154259 15.9987197,26.8234219 C15.8889583,26.8554056 16.2333822,26.8154259 16.0706324,26.811428 C16.0100744,26.811428 15.9495163,26.811428 15.8889583,26.80743 C15.7678422,26.80743 16.1009115,26.8554056 15.9873651,26.8194239 C15.960871,26.811428 15.9343768,26.80743 15.9116675,26.7994341 C15.8700339,26.7874402 15.6732202,26.7154768 15.8284002,26.7754463 C15.9684407,26.8314178 15.8586793,26.7834422 15.8208305,26.7634524 C15.7867666,26.7434626 15.7451329,26.703483 15.7072841,26.6874911 C15.711069,26.6874911 15.8548944,26.8274198 15.7905514,26.7554565 C15.8094758,26.7794443 15.6656505,26.6315196 15.7299934,26.695487 C15.7299934,26.695487 15.7299934,26.695487 15.7299934,26.695487 C15.7262085,26.6914891 15.7224236,26.6874911 15.7186388,26.6834931 C15.7034992,26.6675013 15.6883597,26.6515094 15.6732202,26.6355176 C15.5104705,26.4636052 15.3477207,26.2916927 15.1849709,26.1197803 C14.469629,25.3641652 13.754287,24.6085501 13.0389451,23.852935 C12.0321675,22.7894768 11.0291748,21.7300164 10.0223972,20.6665582 C8.99669525,19.5831101 7.97477816,18.5036599 6.9490762,17.4202119 C6.18074594,16.6086253 5.40863081,15.7930407 4.64030055,14.9814542 C4.43591714,14.7655641 4.23153372,14.5496741 4.0271503,14.3337841 C3.98551664,14.2898065 3.94388298,14.2458289 3.90224932,14.2018513 C3.67515664,13.9619735 3.48969761,13.6781181 3.26260493,13.4422382 C3.27395956,13.4542321 3.40264542,13.6381384 3.31180834,13.5062057 C3.29666883,13.4822179 3.27774444,13.4582301 3.26260493,13.4382403 C3.22475614,13.3822688 3.18690736,13.3302953 3.15284346,13.2743238 C3.06957614,13.1503869 2.9900937,13.0224521 2.91439614,12.8905193 C2.77435565,12.6506415 2.64566979,12.4027677 2.52833857,12.1468981 C2.50184443,12.0869286 2.47535028,12.0269592 2.44885613,11.9669897 C2.41857711,11.8990244 2.34287955,11.6871323 2.44885613,11.9749857 C2.39965272,11.8430529 2.3504493,11.715118 2.30503077,11.5831852 C2.21797857,11.3193197 2.13849613,11.0554541 2.07793808,10.7835926 C2.01359515,10.515729 1.96817661,10.2438675 1.92654296,9.96800801 C1.91140344,9.85606504 1.94546735,10.1119347 1.94168247,10.0959428 C1.93789759,10.0599612 1.93411271,10.0239795 1.93032783,9.98799783 C1.92275808,9.92403042 1.9189732,9.860063 1.91140344,9.79609559 C1.90004881,9.66016483 1.89247905,9.52023611 1.88869417,9.38430535 C1.87733954,9.10844588 1.88112442,8.8325864 1.90004881,8.55672692 C1.90761856,8.42879209 1.9189732,8.30085726 1.93032783,8.17292243 C1.93411271,8.13694076 1.94168247,8.10095909 1.94168247,8.06497742 C1.94168247,8.07297335 1.90383369,8.32884301 1.93032783,8.1649265 C1.94168247,8.09296316 1.9530371,8.02099982 1.96439174,7.94503852 C2.05522881,7.39731752 2.1952693,6.86159042 2.39208296,6.34585314 C2.4034376,6.32186536 2.41100735,6.29387962 2.42236199,6.26989184 C2.46778052,6.1539509 2.33909467,6.46979001 2.38829808,6.35384907 C2.41479223,6.29387962 2.4375015,6.23391016 2.46399565,6.17394071 C2.52076882,6.04600588 2.57754199,5.91807105 2.64188492,5.79413419 C2.76678589,5.54226249 2.90682638,5.29838672 3.05822151,5.06250688 C3.13013419,4.9505639 3.20583175,4.84261889 3.27774444,4.73467388 C3.34965712,4.63072683 3.15284346,4.89859038 3.22854102,4.79864129 C3.24746541,4.77465351 3.26260493,4.75466369 3.28152932,4.73067591 C3.33451761,4.66271053 3.3875059,4.59474516 3.4404942,4.53077774 C3.62595322,4.30289383 3.82276688,4.08300584 4.03093518,3.8791097 C4.14448152,3.76716672 4.26559762,3.65522375 4.38671372,3.5512767 C4.40942299,3.53128688 4.43591714,3.51129706 4.45862641,3.48730928 C4.58731226,3.37536631 4.4245625,3.5072991 4.41320787,3.52329096 C4.45862641,3.4633215 4.54946348,3.41534594 4.61380641,3.36737038 C4.86360836,3.1794661 5.12476495,3.00755367 5.3934913,2.8516331 C5.51839227,2.77966976 5.64329325,2.71170438 5.77197911,2.64773696 C5.83632204,2.61575326 5.90066496,2.58776751 5.96500789,2.5557838 C6.07855423,2.49981232 5.7909035,2.63174511 5.90444984,2.57977158 C5.94986838,2.55978177 5.99907179,2.53979195 6.04449033,2.51980213 C6.32457131,2.40386119 6.61222205,2.30791007 6.90365766,2.2279508 C7.18373864,2.1519895 7.4676045,2.09601801 7.75525523,2.04804245 C7.88015621,2.02805263 7.55465669,2.07203023 7.67955767,2.06003634 C7.7098367,2.05603837 7.74011572,2.05204041 7.76660987,2.04804245 C7.84609231,2.04004652 7.92557475,2.03205059 8.00505719,2.02405467 C8.15266743,2.01206078 8.30406256,2.00406485 8.4516728,2.00006689 C8.75067817,1.99207096 9.05346842,2.00806281 9.35247379,2.03604856 C9.41681672,2.04404448 9.50008404,2.07203023 9.56064209,2.06003634 C9.56442697,2.06003634 9.35247379,2.02805263 9.45845038,2.04404448 C9.50008404,2.05204041 9.53793282,2.05603837 9.57956648,2.0640343 C9.72717673,2.08802208 9.87857185,2.12000579 10.0261821,2.1519895 C10.3214026,2.21995488 10.6166231,2.30791007 10.9004889,2.41585508 C11.0329597,2.46383064 11.1654304,2.52779806 11.2979011,2.57577362 C11.0405294,2.48382046 11.2941163,2.57577362 11.3508894,2.60375936 C11.426587,2.63974104 11.4984997,2.67572271 11.5741972,2.71570234 C11.8504933,2.86362699 12.1192197,3.02754349 12.3765914,3.20745184 C12.4977075,3.29140908 12.6150387,3.38336223 12.7361548,3.47531539 C12.7891431,3.51529503 12.8307768,3.59125633 12.6945212,3.43933372 C12.7172304,3.4633215 12.7437246,3.48331132 12.7702187,3.50330114 C12.8459163,3.56726855 12.917829,3.63123597 12.9897416,3.69920135 C13.1865553,3.88310766 13.3720143,4.07900787 13.5612582,4.27490808 C14.034368,4.77465351 14.5112626,5.2783969 14.9843724,5.77814233 C15.0979188,5.89808124 15.2076802,6.01402218 15.3212266,6.13396108 C15.68079,6.51376761 16.2977251,6.51776557 16.6610734,6.13396108 C17.0282066,5.74615863 17.3915549,5.36235414 17.7586881,4.97455168 C18.1598851,4.55076756 18.5497276,4.10699362 18.9774188,3.71119524 C19.0796105,3.61524411 19.1855871,3.52728892 19.2915637,3.43533576 C19.3710461,3.36737038 19.2007266,3.51129706 19.2082964,3.50330114 C19.2385754,3.48331132 19.2650695,3.45532558 19.2953486,3.43533576 C19.3521217,3.39135816 19.4126798,3.34738056 19.469453,3.30340297 C19.6889759,3.14348443 19.9160686,2.99555978 20.150731,2.85962902 C20.2604925,2.79566161 20.370254,2.73569216 20.4800154,2.67972067 C20.5443583,2.64773696 20.6087013,2.61575326 20.6692593,2.58376955 C20.6919686,2.57177566 20.7184627,2.55978177 20.741172,2.55178584 C20.8812125,2.48781843 20.7449569,2.5557838 20.6843988,2.57577362 C20.9342008,2.49581435 21.1726481,2.37987341 21.4262349,2.29991414 C21.6760369,2.21995488 21.9296237,2.15598746 22.1869954,2.10401394 C22.3043267,2.08002615 22.4254428,2.06803226 22.5465589,2.04004652 C22.5389891,2.04004652 22.292972,2.07203023 22.448152,2.05603837 C22.4746462,2.05204041 22.5011403,2.04804245 22.5238496,2.04804245 C22.5919774,2.04004652 22.6601052,2.03205059 22.7320179,2.02805263 C23.2505462,1.98407503 23.7690745,1.99207096 24.2838179,2.05603837 C24.4919862,2.08002615 24.0983589,2.02405467 24.2648935,2.05204041 C24.3254516,2.0640343 24.3860096,2.07203023 24.4427828,2.08402412 C24.5790384,2.1080119 24.715294,2.13599764 24.8515496,2.17197931 C25.0975667,2.23194877 25.3397989,2.30391211 25.5782462,2.38786934 C25.7031472,2.43184694 25.8242633,2.4798225 25.9491643,2.52779806 C25.9718735,2.53979195 25.9983677,2.54778788 26.021077,2.55978177 C26.1649023,2.61975122 25.9491643,2.52779806 25.9415945,2.5238001 C26.0059374,2.5557838 26.0702804,2.58376955 26.1346233,2.61575326 C26.3768555,2.73169419 26.6115179,2.86362699 26.8386106,3.00755367 C27.0694882,3.15148036 27.2890111,3.31539686 27.5085341,3.47931336 C27.6410048,3.57926244 27.3495692,3.3433826 27.5085341,3.47931336 C27.5577375,3.51929299 27.6069409,3.56327059 27.6561443,3.60724819 C27.7696906,3.70719727 27.8794521,3.81114432 27.9854287,3.91509137 C28.1860272,4.11498954 28.3752711,4.32688161 28.5569453,4.54676959 C28.5985789,4.59874312 28.6402126,4.65071664 28.6780614,4.70269017 C28.719695,4.75866166 28.8408111,4.94656594 28.6818463,4.70269017 C28.7575438,4.81863111 28.8408111,4.93057408 28.9165087,5.05051299 C29.0679038,5.28239487 29.2041594,5.52627064 29.3290604,5.77414437 C29.3858336,5.89008531 29.4426068,6.00602625 29.4955951,6.12196719 C29.5220892,6.18193664 29.5485833,6.23790813 29.5712926,6.29787758 C29.5864321,6.32986129 29.5977868,6.36584296 29.6129263,6.39782667 C29.5826473,6.33385925 29.529659,6.18993257 29.5864321,6.33785721 C29.775676,6.84160061 29.9195014,7.36533382 30.0103385,7.89706295 C30.0216931,7.9690263 30.0330477,8.04098964 30.0444024,8.11295298 C30.0481873,8.14093872 30.0519721,8.16892447 30.055757,8.19291225 C30.0746814,8.32084708 30.0292629,7.96103037 30.0444024,8.0889652 C30.0595419,8.22489596 30.0746814,8.36082671 30.0822512,8.49675747 C30.1011756,8.76861898 30.1087453,9.04447846 30.1011756,9.31633997 C30.0936058,9.59219945 30.0595419,9.860063 30.0406175,10.1359225 C30.0406175,10.1279266 30.0784663,9.86805893 30.0519721,10.0319754 C30.0481873,10.0599612 30.0444024,10.0879469 30.0406175,10.1119347 C30.0330477,10.1759021 30.0216931,10.2398695 30.0103385,10.299839 C29.9838443,10.4437657 29.9573502,10.5876923 29.9232863,10.731619 C29.8627282,10.9994826 29.7908155,11.2633482 29.7037634,11.5232158 C29.6621297,11.6471527 29.620496,11.7670916 29.5750775,11.8870305 C29.5145194,12.046949 29.6696994,11.6591465 29.5788624,11.8790345 C29.5523682,11.9469999 29.5220892,12.0149653 29.4918102,12.0829307 C29.3782638,12.3348024 29.2533629,12.5826761 29.1133224,12.8225539 C29.0489794,12.9344969 28.9808516,13.0464399 28.908939,13.1543849 C28.874875,13.2103564 28.8370263,13.2623299 28.8029624,13.3183014 C28.7802531,13.3502851 28.7613287,13.3782708 28.7386194,13.4102545 C28.7159102,13.4422382 28.6175033,13.578169 28.7159102,13.4462362 C28.8105321,13.3143034 28.6818463,13.4902138 28.6553521,13.5261955 C28.6137185,13.578169 28.5758697,13.6301425 28.534236,13.682116 C28.4396141,13.798057 28.3412072,13.9139979 28.2390155,14.0259409 C28.2049516,14.0659205 28.1671028,14.1059002 28.1292541,14.1418818 C28.0876204,14.1858594 28.0459867,14.229837 28.0043531,14.2738146 C27.4669004,14.8415254 26.9332326,15.4052383 26.3957799,15.9729491 C25.4646999,16.9564481 24.5336199,17.9399471 23.598755,18.9274441 C22.5503437,20.0348799 21.5019325,21.1423158 20.4535213,22.2497517 C19.5527203,23.201267 18.6481344,24.1567802 17.7473334,25.1082955 C17.2704388,25.6120389 16.7935441,26.1157823 16.3166495,26.6195257 C16.30151,26.6515094 16.2788007,26.6714992 16.2560915,26.695487 C15.9040978,27.0672976 15.8813885,27.7429534 16.2560915,28.1107661 C16.6345793,28.4785787 17.2212354,28.5065645 17.5959383,28.1107661 C17.9441471,27.7429534 18.288571,27.3791388 18.6367798,27.0113261 C19.4845925,26.1157823 20.3324052,25.2202385 21.1802179,24.3246947 C22.2437686,23.201267 23.3035345,22.0818372 24.3670852,20.9584095 C25.3549384,19.914941 26.3427916,18.8714726 27.3344297,17.8240062 C27.9627194,17.1603442 28.5947941,16.4926843 29.2230838,15.8290224 C29.3290604,15.7170794 29.4388219,15.6051365 29.5447985,15.4891955 C30.396396,14.5696639 31.0360404,13.4742219 31.4675165,12.2748329 C32.2964049,9.96800801 32.1336551,7.35733789 31.1458019,5.13447022 C30.1390243,2.87162292 28.1898121,1.14450271 25.9378096,0.404879475 C23.7160862,-0.326747834 21.236991,-0.046890393 19.2007266,1.13250882 C17.823031,1.92810354 16.7708349,3.19545795 15.6732202,4.35486735 C15.5596739,4.47480625 15.4423427,4.59874312 15.3287963,4.71868202 C15.7754119,4.71868202 16.2220275,4.71868202 16.6686432,4.71868202 C16.2863705,4.31488772 15.9040978,3.91109341 15.5180402,3.50330114 C15.0638549,3.02354553 14.6210241,2.51580417 14.1214202,2.08802208 C13.0427299,1.16449253 11.7861504,0.492834671 10.4235943,0.196985377 C9.09888696,-0.0908679908 7.72497621,-0.0668802102 6.41162351,0.292936499 C3.92495859,0.976588247 1.75622344,2.89161273 0.738091231,5.39433784 C0.26119659,6.57373706 -0.00374487715,7.82110165 0,9.10844588 C0.00382487906,10.3877942 0.272551224,11.6271628 0.749445865,12.7985661 C1.24148002,14.013947 2.01738003,15.0254318 2.89168687,15.9529593 C3.55782542,16.6566008 4.22396396,17.3602424 4.89010251,18.063884 C5.90444984,19.1353382 6.91879717,20.2067924 7.92935963,21.2742486 C8.99291037,22.3976763 10.0564611,23.5211041 11.1200119,24.6445318 C11.9337607,25.5040939 12.7512943,26.367654 13.5650431,27.2272162 C14.1024958,27.794927 14.6475183,28.5145604 15.4120636,28.7224545 C16.1993183,28.9383445 17.016852,28.6944687 17.5997232,28.1027702 C17.9592866,27.7389555 17.9706412,27.0473078 17.5997232,26.6874911 C17.2098807,26.3236764 16.6383641,26.3076846 16.2560915,26.695487 Z" id="empty"></path>
                          	</g>
                      	</g>
                  	</g>
              	</g>
          	</g>
      	</svg>';
		ob_start();
		?>
		<div class="wovax-idx-listing-favorite-container">
			<div class="wovax-idx-listing-favorite">
			<label id="toggle-heart-section"><?php echo $label_value; ?></label>
			</div>
		</div>
		<?php
		$favorite_html = ob_get_clean();
		?>
		<div class="wrap">
			<h1 class="wp-heading-inline">Wovax IDX Edit Listing Card</h1>
			<hr class="wp-header-end">
			<div class="wovax-idx-settings-listing-card-container">
				<div class="wovax-idx-listing-container">
					<div class="wovax-idx-listing">
						<div class="wovax-idx-listing-image">
							<img class="wovax-idx-listing-featured-image" src="https://cache.wovax.com/images/placeholder.jpg">
							<div id="wovax-idx-image-overlay" class="wovax-idx-listing-status <?php echo $current_status_class; ?>">Example Status</div>
						</div>
						<div class="wovax-idx-listing-content">
							<div class="wovax-idx-listing-title">Listing Street Address
								<div class="wovax-idx-listing-subtitle">Listing City, State, Zip Code</div>
							</div>
							<?php echo $favorite_html; ?>
							<div class="wovax-idx-listing-details">
								<div>1 bed | 2 bath</div>
								<div>1 acre | 1,500 sqft</div>
							</div>
							<div class="wovax-idx-listing-price">Example Price</div>
							<div class="wovax-idx-listing-mls-logo"><img src="https://cache.wovax.com/image/?src=<?php echo $mls_logo; ?>"></div>
						</div>
					</div>
				</div>
			</div>
			<form method="POST" action="<?php echo admin_url('admin-post.php') ?>">
				<input type="hidden" name="action" value="wovax_idx_listing_card">
				<?php wp_nonce_field('wovax-listing-card'); ?>
				<div class="wovax-idx-settings-listing-card-modify">
					<select name="status-class" class="wovax-idx-listing-card-style">
						<?php echo $status_dropdown_options; ?>
					</select>
				</div>
				<?php submit_button(); ?>
			</form>	
		</div>
		<?php
	}

	public static function updateSettings() {
		if (!current_user_can('manage_options')) {
			wp_die('You cannot manage options.', 'Unauthorized User', 401);
		}
        check_admin_referer('wovax-listing-card');
		$opts        = new ListingCardSettings();
		foreach($_POST as $key => $value) {
			switch($key) {
				case 'status-class':
					$opts->setStatusClass($value);
					break;
			}
		}
		wp_redirect(admin_url('admin.php?page=wovax_idx_settings&tab=listing-card'), 303);
	} 

}
add_action('admin_post_wovax_idx_listing_card', __NAMESPACE__.'\ListingCardAdmin::updateSettings');